# Configuration Guide for @medishn/gland

This guide provides a detailed overview of the configuration options available in `@medishn/gland`, allowing you to customize the behavior of your web server, routing, logging, middleware, and database query execution. These configurations can be defined in a separate configuration file, typically named `.confmodule`, and loaded into your application.

## Table of Contents

- [Configuration Guide for @medishn/gland](#configuration-guide-for-medishngland)
  - [Table of Contents](#table-of-contents)
  - [Introduction](#introduction)
  - [Basic Configuration](#basic-configuration)
  - [Configuration Options](#configuration-options)
    - [Server Configuration](#server-configuration)
      - [Example](#example)
    - [Logging Configuration](#logging-configuration)
      - [Example](#example-1)
    - [Database Configuration (Qiu)](#database-configuration-qiu)
      - [Example](#example-2)
    - [Loading Configuration](#loading-configuration)
    - [Best Practices](#best-practices)

---

## Introduction

`gland` supports both programmatic and file-based configuration to allow flexible and maintainable setups. The framework uses the `.confmodule` file for configuration, which can include details about routing, middleware, logging, and database connections. This file is loaded during server initialization.

The configuration system is designed to:

- Define paths for routes and middleware.
- Set up logging preferences (log levels, transport options, etc.).
- Configure SQL database connections for `Qiu`.
- Customize global or route-specific middleware.

## Basic Configuration

Below is an example of a basic `.confmodule` configuration file:

```
path=router
recursive=true
pattern=*.ts
cacheModules=true
logLevel=info
```

In this example:
- **`path=router`** specifies the directory where route modules are located.
- **`recursive=true`** indicates that the framework should search for route files recursively.
- **`pattern=*.ts`** sets the file pattern to match for route files.
- **`cacheModules=true`** enables module caching.
- **`logLevel=info`** sets the logging level to `info`.

## Configuration Options

The `.confmodule` file can contain several key configuration options, each affecting different parts of the application.

### Server Configuration

The server configuration controls how the web server behaves and interacts with routes and middleware. Key server settings include:

| Option            | Type    | Description                                                                           | Default Value |
|-------------------|---------|---------------------------------------------------------------------------------------|---------------|
| `path`            | String  | Specifies the directory where route modules are located.                              | `'router'`    |
| `recursive`       | Boolean | Whether to recursively search for route files in subdirectories.                      | `true`        |
| `pattern`         | String  | File pattern to match for route modules (e.g., `*.ts`, `*.js`).                        | `*.ts`        |
| `cacheModules`    | Boolean | Enables or disables caching of route and middleware modules for better performance.    | `true`        |
| `logLevel`        | String  | Defines the level of logging (`error`, `warn`, `info`, `debug`).                      | `'info'`      |

#### Example

```ini
path=router
recursive=true
pattern=*.js
cacheModules=false
logLevel=debug
```

### Logging Configuration

Logging configuration defines how logs are captured, where they are stored, and how they are formatted. `gland` uses the `@medishn/gland-logger` package for logging, which can log to both the console and files with support for log rotation.

| Option           | Type    | Description                                                                          | Default Value |
|------------------|---------|--------------------------------------------------------------------------------------|---------------|
| `logLevel`       | String  | Defines the log level (`info`, `warn`, `error`, `debug`).                             | `'info'`      |
| `transports`     | Array   | Specifies where to log (`console`, `file`).                                           | `['console']` |
| `file`           | String  | Path to the log file (e.g., `combined.log`).                                      | `null`        |
| `rotation`       | Object  | Configuration for log rotation, including `maxSize` for file size limits.             | `null`        |

#### Example

```json
{
  "logLevel": "debug",
  "transports": ["file", "console"],
  "file": "app.log",
  "rotation": {
    "maxSize": 1048576 // 1MB
  }
}
```

This configuration logs to both the console and a file (`app.log`). Log files are rotated when they exceed 1 MB in size.

### Database Configuration (Qiu)

`gland` includes built-in support for SQL databases via `Qiu`, which allows you to run SQL queries for databases like MySQL, PostgreSQL, and MariaDB.

| Option      | Type    | Description                                                    | Default Value |
|-------------|---------|----------------------------------------------------------------|---------------|
| `driver`    | String  | Database driver (`pg`, `mysql`, `mariadb`).                    | `'pg'`        |
| `url`       | String  | Database connection URL (e.g., `postgresql://...`).            | `null`        |
| `dbName`    | String  | Name of the database to use.                                   | `null`        |

#### Example

```json
{
  "driver": "mysql",
  "url": "mysql://user:password@localhost:3306/mydatabase",
  "dbName": "mydatabase",
}
```

In this example, `Qiu` connects to a MySQL database hosted locally, using a connection pool of 10 connections.

### Loading Configuration

You can load the configuration file (`.confmodule`) in your main application file using the `load()` method.

```typescript
import gland from '@medishn/gland';
import path from 'path';

const app = new gland();

// Load configuration
app.load(path.join(__dirname, '.confmodule'));

// Initialize the server
app.init(3000, () => {
  console.log('Server running on port 3000');
});
```

### Best Practices

- **Use separate configuration files for different environments (development, production, etc.).**
  You can name them `.confmodule.dev`, `.confmodule.prod`, and load the appropriate configuration based on the environment.

- **Avoid hardcoding sensitive information** (e.g., database credentials) in your configuration files. Instead, use environment variables or a secrets management system.

- **Use the `cacheModules` option in production** to improve performance by caching route and middleware modules.
